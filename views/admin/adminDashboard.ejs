<!DOCTYPE html>
<html>
  <head>
    <title>Vbook4U | Admin Dashboard</title>
    <link rel="stylesheet" href="/css/adminDashboard.css" />
  </head>
  <body>
    <header>
      <div class="footer-links">
        <button class="admin-info-button"><%= admin.fullname %></button>
        <a href="#" class="vbook4u-link">Vbook4U.com</a>
        <form action="/admin/logout" method="POST" class="logout-form">
          <button type="submit" class="logout-button">Logout</button>
        </form>
      </div>
    </header>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <a href="#" id="profileLink">PROFILE</a>
        <a href="#" id="dashboardLink">DASHBOARD</a>
        <a href="#" id="ownersLink">OWNERS</a>
        <a href="#" id="usersLink">USERS</a>
        <a href="#" id="categoriesLink">CATEGORIES</a>
        <a href="#" id="salesReportLink">SALES REPORT</a>
        <a href="#" id="bookingsLink">BOOKINGS</a>
        <a href="#" id="deletionLink">DELETION</a>
        <a href="#" id="requestLink">REQUESTS</a>
        <!-- Added REQUESTS link -->
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Profile Section -->
        <% if (admin) { %>
        <div id="profileSection">
          <h2>Profile</h2>
          <!-- Display admin profile details here -->
          <table class="profile-table">
            <tr>
              <td>Name:</td>
              <td><%= admin.fullname %></td>
            </tr>
            <tr>
              <td>Email:</td>
              <td><%= admin.email %></td>
            </tr>
            <tr>
              <td>Phone No:</td>
              <td><%= admin.phoneNumber %></td>
            </tr>
          </table>
        </div>

        <% } %>

        <!-- Dashboard Section -->
        <div id="dashboardSection" style="display: none">
          <!-- Content for Dashboard -->
        </div>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            displaySection("dashboardSection");
          });
          function displaySection(sectionId) {
            // Hide all sections
            var sections = document.querySelectorAll(".main-content > div");
            sections.forEach(function (section) {
              section.style.display = "none";
            });

            // Show the selected section
            var selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
              selectedSection.style.display = "block";
            } else {
              // Hide all sections if no section ID is provided
              sections.forEach(function (section) {
                section.style.display = "none";
              });
            }
          }
        </script>

        <!-- Owners Section -->
        <div
          id="ownersSection"
          class="scrollable-section1"
          style="display: none"
        >
          <h2>Owners</h2>
          <% if (owners.length > 0) { %>
          <!-- Display owners as a styled table -->
          <table class="owners-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone No</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% owners.forEach(function(owner) { %>
              <tr>
                <td><%= owner.fullname %></td>
                <td><%= owner.email %></td>
                <td><%= owner.phoneNumber %></td>
                <td>
                  <% if (owner.isBlocked) { %>
                  <!-- If owner is blocked, show Unblock button -->
                  <form
                    method="POST"
                    action="/admin/owners/<%= owner._id %>/unblock"
                    class="action-form"
                  >
                    <button type="submit">Unblock</button>
                  </form>
                  <% } else { %>
                  <!-- If owner is not blocked, show Block button -->
                  <form
                    method="POST"
                    action="/admin/owners/<%= owner._id %>/block"
                    class="action-form"
                  >
                    <button type="submit">Block</button>
                  </form>
                  <% } %>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
          <% } else { %>
          <p>No owners found.</p>
          <% } %>
        </div>

        <!-- Users Section -->

        <div id="usersSection">
          <h2>Users</h2>
          <% if (users.length > 0) { %>
          <!-- Display users as a table -->
          <table class="users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone No</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(function(user) { %>
              <tr>
                <td><%= user.fullname %></td>
                <td><%= user.email %></td>
                <td><%= user.phoneNumber %></td>
                <td>
                  <% if (user.isBlocked) { %>
                  <!-- If user is blocked, show Unblock button -->
                  <form
                    method="POST"
                    action="/admin/users/<%= user._id %>/unblock"
                    class="action-form"
                  >
                    <button type="submit">Unblock</button>
                  </form>
                  <% } else { %>
                  <!-- If user is not blocked, show Block button -->
                  <form
                    method="POST"
                    action="/admin/users/<%= user._id %>/block"
                    class="action-form"
                  >
                    <button type="submit">Block</button>
                  </form>
                  <% } %>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
          <% } else { %>
          <p>No users found.</p>
          <% } %>
        </div>

        <!-- Categories Section -->
        <div id="categoriesSection" style="display: none; padding: 10px 20px">
          <h2>Categories</h2>

          <!-- Add New Category Form -->

          <!-- Error/Success Messages for Add Category -->
          <% if (addCategoryError) { %>
          <div class="error-message"><%= addCategoryError %></div>
          <% } %> <% if (addCategorySuccess) { %>
          <div class="success-message"><%= addCategorySuccess %></div>
          <% } %>

          <!-- Success Message for Category Deletion -->
          <% if (categoryDeletedSuccess) { %>
          <div class="success-message"><%= categoryDeletedSuccess %></div>
          <% } %> <% if (categories.length > 0) { %>
          <!-- Display existing categories as a table -->
          <div class="scrollable-section2">
            <table class="categories-table">
              <thead>
                <tr>
                  <th>Category Name</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% categories.forEach(function(category) { %>
                <tr>
                  <td><%= category.name %></td>
                  <td>
                    <form
                      method="POST"
                      action="/admin/categories/<%= category._id %>/delete"
                      style="display: inline"
                    >
                      <button class="btn-del" type="submit">Delete</button>
                    </form>
                    <form
                      method="GET"
                      action="/admin/categories/<%= category._id %>/edit"
                      style="display: inline"
                    >
                      <button class="btn-edit" type="submit">Edit</button>
                    </form>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <% } else { %>
          <p>No categories found.</p>
          <% } %>
          <h3>Add New Category</h3>
          <form id="addCategoryForm" method="POST" action="/admin/categories">
            <table class="add-category-table">
              <tr>
                <td><label for="categoryName">Name:</label></td>
                <td>
                  <input
                    type="text"
                    id="categoryName"
                    name="name"
                    required
                    pattern="[A-Za-z0-9./#]+"
                    title="Only letters, numbers, ., /, and # allowed"
                  />
                </td>
              </tr>
              <tr>
                <td><label for="categoryDescription">Description:</label></td>
                <td>
                  <textarea
                    id="categoryDescription"
                    name="description"
                    required
                  ></textarea>
                </td>
              </tr>
              <tr>
                <td></td>
                <td><button type="submit">Add Category</button></td>
              </tr>
            </table>
          </form>
        </div>

        <div id="requestsSection">
          <h2>Property Requests</h2>
          <% if (requests.length > 0) { %>
          <!-- Display property requests as a table -->
          <table class="requests-table">
            <thead>
              <tr>
                <th>Property Name</th>
                <th>Category</th>
                <th>Description</th>
                <th>Address</th>
                <th>Price</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% requests.forEach(function(request) { %>
              <tr>
                <td><%= request.propertyName %></td>
                <td><%= request.categoryName %></td>
                <td><%= request.description %></td>
                <td><%= request.address %></td>
                <td><%= request.price %></td>
                <td>
                  <form
                    method="POST"
                    action="/admin/requests/<%= request._id %>/approve"
                    class="action-form"
                  >
                    <button type="submit">Approve</button>
                  </form>
                  <form
                    method="POST"
                    action="/admin/requests/<%= request._id %>/reject"
                    class="action-form"
                  >
                    <button type="submit">Reject</button>
                  </form>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
          <% } else { %>
          <p>No property requests found.</p>
          <% } %>
        </div>

        <!-- Sales Report Section -->
        <div id="salesReportSection" style="display: none">
          <!-- Content for Sales Report -->
        </div>

        <!-- Bookings Section -->
        <div id="bookingsSection" style="overflow-x: auto">
          <h2>Bookings</h2>
          <% if (bookings.length > 0) { %>
          <!-- Display bookings as a table -->
          <div class="scrollable-section">
            <table class="bookings-table">
              <thead>
                <tr>
                  <th>Property</th>
                  <th>Check-in</th>
                  <th>Check-out</th>
                  <th>User</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Payment Method</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone Number</th>
                </tr>
              </thead>
              <tbody>
                <% bookings.forEach(function(booking) { %>
                <tr>
                  <td>
                    <%= booking.property ? booking.property.propertyName : 'N/A'
                    %>
                  </td>
                  <td><%= booking.checkIn %></td>
                  <td><%= booking.checkOut %></td>
                  <td><%= booking.user ? booking.user.fullname : 'N/A' %></td>
                  <td><%= booking.price %></td>
                  <td><%= booking.bookingStatus %></td>
                  <td><%= booking.payMethod %></td>
                  <td><%= booking.name %></td>
                  <td><%= booking.email %></td>
                  <td><%= booking.phoneNumber %></td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <% } else { %>
          <p>No bookings found.</p>
          <% } %>
        </div>

        <div
          id="deletionSection"
          class="scrollable-section"
          style="display: none"
        >
          <h2>Deletion</h2>
          <% if (properties.length > 0) { %>
          <table class="deletion-table">
            <thead>
              <tr>
                <th>Owner</th>
                <th>Property Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% properties.forEach(function(property) { %>
              <tr>
                <td><%= property.owner.fullname %></td>
                <td><%= property.propertyName %></td>
                <td>
                  <!-- Add delete button with corresponding action -->
                  <form
                    method="POST"
                    action="/admin/properties/<%= property._id %>/delete"
                  >
                    <button class="btn-del" type="submit">Delete</button>
                  </form>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
          <% } else { %>
          <p>No properties to delete.</p>
          <% } %>
        </div>

        <!-- Error/Success Messages Section -->
        <% if (messages.error) { %>
        <div class="error-message"><%= messages.error %></div>
        <% } %> <% if (messages.success) { %>
        <div class="success-message"><%= messages.success %></div>
        <% } %>
      </div>
    </div>

    <script>
      //script for add category
      document.addEventListener("DOMContentLoaded", function () {
        const addCategoryForm = document.getElementById("addCategoryForm");
        const categoryNameInput = document.getElementById("categoryName");
        const categoryDescriptionInput = document.getElementById(
          "categoryDescription"
        );
        const addCategoryButton = document.getElementById("addCategoryButton");

        addCategoryForm.addEventListener("submit", function (event) {
          if (!categoryNameInput.value || !categoryDescriptionInput.value) {
            event.preventDefault(); // Prevent form submission
            alert("Please provide both name and description");
          }
        });

        categoryNameInput.addEventListener("input", toggleAddCategoryButton);
        categoryDescriptionInput.addEventListener(
          "input",
          toggleAddCategoryButton
        );

        function toggleAddCategoryButton() {
          if (categoryNameInput.value && categoryDescriptionInput.value) {
            addCategoryButton.disabled = false;
          } else {
            addCategoryButton.disabled = true;
          }
        }
      });
    </script>

    <!-- JavaScript to Show/Hide Sections based on Clicked Links -->
    <script>
      document
        .getElementById("profileLink")
        .addEventListener("click", function () {
          displaySection("profileSection");
        });

      document
        .getElementById("dashboardLink")
        .addEventListener("click", function () {
          displaySection("dashboardSection");
        });

      document
        .getElementById("ownersLink")
        .addEventListener("click", function () {
          displaySection("ownersSection");
        });

      document
        .getElementById("usersLink")
        .addEventListener("click", function () {
          displaySection("usersSection");
        });

      document
        .getElementById("categoriesLink")
        .addEventListener("click", function () {
          displaySection("categoriesSection");
        });

      document
        .getElementById("salesReportLink")
        .addEventListener("click", function () {
          displaySection("salesReportSection");
        });

      document
        .getElementById("bookingsLink")
        .addEventListener("click", function () {
          displaySection("bookingsSection");
        });

      document
        .getElementById("deletionLink")
        .addEventListener("click", function () {
          displaySection("deletionSection");
        });

      document
        .getElementById("requestLink")
        .addEventListener("click", function () {
          displaySection("requestsSection");
        });

      function displaySection(sectionId) {
        // Hide all sections
        var sections = document.querySelectorAll(".main-content > div");
        sections.forEach(function (section) {
          section.style.display = "none";
        });

        // Show the selected section
        var selectedSection = document.getElementById(sectionId);
        if (selectedSection) {
          selectedSection.style.display = "block";
        }
      }
    </script>
  </body>
</html>
