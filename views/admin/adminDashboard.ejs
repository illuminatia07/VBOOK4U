<!DOCTYPE html>
<html>
  <head>
    <title>Vbook4U | Admin Dashboard</title>
    <link rel="stylesheet" href="/css/adminDashboard.css" />
  </head>
  <body>

    <header>
      <div class="footer-links">
        <button class="admin-info-button"><%= admin.fullname %></button>
        <a href="#" class="vbook4u-link">Vbook4U.com</a>
        <form action="/admin/logout" method="POST" class="logout-form">
          <button type="submit" class="logout-button">Logout</button>
        </form>
      </div>
    </header>
    <script>
      // Function to hide flash messages after 2 seconds
      function hideFlashMessages() {
        setTimeout(function () {
          var successMessage = document.getElementById("success-message");
          var errorMessage = document.getElementById("error-message");
          if (successMessage) {
            successMessage.style.display = "none";
          }
          if (errorMessage) {
            errorMessage.style.display = "none";
          }
        }, 2000); // 2000 milliseconds = 2 seconds
      }
      // Call the function after the DOM is fully loaded
      document.addEventListener("DOMContentLoaded", hideFlashMessages);
    </script>
    <% if (messages.error && messages.error.length > 0) { %>
      <div id="error-message" class="error-message">
        <% messages.error.forEach(function(msg) { %>
          <p><%= msg %></p>
        <% }); %>
      </div>
    <% } %>

    <% if (messages.success && messages.success.length > 0) { %>
      <div id="success-message" class="success-message">
        <% messages.success.forEach(function(msg) { %>
          <p><%= msg %></p>
        <% }); %>
      </div>
    <% } %>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <a href="#" id="profileLink">PROFILE</a>
        <a href="#" id="dashboardLink">DASHBOARD</a>
        <a href="#" id="ownersLink">OWNERS</a>
        <a href="#" id="usersLink">USERS</a>
        <a href="#" id="categoriesLink">CATEGORIES</a>
        <a href="#" id="salesReportLink">SALES REPORT</a>
        <a href="#" id="bookingsLink">BOOKINGS</a>
        <a href="#" id="deletionLink">DELETION</a>
        <a href="#" id="requestLink">REQUESTS</a>
        <!-- Added REQUESTS link -->
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Profile Section -->
        <% if (admin) { %>
        <div id="profileSection">
          <h2>Profile</h2>
          <!-- Display admin profile details here -->
          <table class="profile-table">
            <tr>
              <td>Name:</td>
              <td><%= admin.fullname %></td>
            </tr>
            <tr>
              <td>Email:</td>
              <td><%= admin.email %></td>
            </tr>
            <tr>
              <td>Phone No:</td>
              <td><%= admin.phoneNumber %></td>
            </tr>
          </table>
        </div>
        <% } %>

        <!-- Dashboard Section -->
        <div id="dashboardSection" style="display: none">
          <!-- Content for Dashboard -->
        </div>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            displaySection("dashboardSection");
          });
          function displaySection(sectionId) {
            // Hide all sections
            var sections = document.querySelectorAll(".main-content > div");
            sections.forEach(function (section) {
              section.style.display = "none";
            });

            // Show the selected section
            var selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
              selectedSection.style.display = "block";
            } else {
              // Hide all sections if no section ID is provided
              sections.forEach(function (section) {
                section.style.display = "none";
              });
            }
          }
        </script>

        <!-- Owners Section -->
        <div id="ownersSection">
          <h2>Owners</h2>
          <div class="scrollable-section1">
            <% if (owners.length > 0) { %>
            <!-- Display owners as a styled table -->
            <table class="owners-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone No</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% owners.forEach(function(owner) { %>
                <tr>
                  <td><%= owner.fullname %></td>
                  <td><%= owner.email %></td>
                  <td><%= owner.phoneNumber %></td>
                  <td>
                    <% if (owner.isBlocked) { %>
                    <!-- If owner is blocked, show Unblock button -->
                    <form
                      method="POST"
                      action="/admin/owners/<%= owner._id %>/unblock"
                      class="action-form"
                    >
                      <button type="submit">Unblock</button>
                    </form>
                    <% } else { %>
                    <!-- If owner is not blocked, show Block button -->
                    <form
                      method="POST"
                      action="/admin/owners/<%= owner._id %>/block"
                      class="action-form"
                    >
                      <button type="submit">Block</button>
                    </form>
                    <% } %>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
            <% } else { %>
            <p>No owners found.</p>
            <% } %>
          </div>
        </div>

        <!-- Users Section -->
        <div id="usersSection">
          <h2>Users</h2>
          <div class="scrollable-section1">
            <% if (users.length > 0) { %>
            <!-- Display users as a table -->
            <table class="users-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone No</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% users.forEach(function(user) { %>
                <tr>
                  <td><%= user.fullname %></td>
                  <td><%= user.email %></td>
                  <td><%= user.phoneNumber %></td>
                  <td>
                    <% if (user.isBlocked) { %>
                    <!-- If user is blocked, show Unblock button -->
                    <form
                      method="POST"
                      action="/admin/users/<%= user._id %>/unblock"
                      class="action-form"
                    >
                      <button type="submit">Unblock</button>
                    </form>
                    <% } else { %>
                    <!-- If user is not blocked, show Block button -->
                    <form
                      method="POST"
                      action="/admin/users/<%= user._id %>/block"
                      class="action-form"
                    >
                      <button type="submit">Block</button>
                    </form>
                    <% } %>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
            <% } else { %>
            <p>No users found.</p>
            <% } %>
          </div>
        </div>

        <!-- Categories Section -->
        <div id="categoriesSection" style="display: none; padding: 10px 20px">
          <h2>Categories</h2>
        
          <% if (messages.categoryDeletedSuccess.length > 0) { %>
            <div id="success-message" class="success-message"><%= messages.categoryDeletedSuccess[0] %></div>
          <% } %>
          <% if (categories.length > 0) { %>
            <!-- Display existing categories as a table -->
            <div class="scrollable-section2">
              <table class="categories-table">
                <thead>
                  <tr>
                    <th>Category Name</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% categories.forEach(function(category) { %>
                    <tr>
                      <td><%= category.name %></td>
                      <td>
                        <form method="POST" action="/admin/categories/<%= category._id %>/delete" style="display: inline">
                          <button class="btn-del" type="submit">Delete</button>
                        </form>
                        <form method="GET" action="/admin/categories/<%= category._id %>/edit" style="display: inline">
                          <button class="btn-edit" type="submit">Edit</button>
                        </form>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          <% } else { %>
            <p>No categories found.</p>
          <% } %>
          <h3>Add New Category</h3>
          <form id="addCategoryForm" method="POST" action="/admin/categories">
            <table class="add-category-table">
              <tr>
                <td><label for="categoryName">Name:</label></td>
                <td>
                  <input
                    type="text"
                    id="categoryName"
                    name="name"
                    required
                    pattern="[A-Za-z0-9./#]+"
                    title="Only letters, numbers, ., /, and # allowed"
                  />
                </td>
              </tr>
              <tr>
                <td><label for="categoryDescription">Description:</label></td>
                <td>
                  <textarea id="categoryDescription" name="description"></textarea>
                </td>
              </tr>
              <tr>
                <td></td>
                <td><button type="submit">Add Category</button></td>
              </tr>
            </table>
          </form>
        </div>

        <!-- Sales Report Section -->
        <div id="salesReportSection" style="display: none">
          <!-- Content for Sales Report -->
        </div>

        <!-- Bookings Section -->
        <div id="bookingsSection" style="display: none">
          <!-- Content for Bookings -->
        </div>

        <!-- Deletion Section -->
        <div id="deletionSection" style="display: none">
          <!-- Content for Deletion -->
        </div>

        <!-- Requests Section -->
        <div id="requestSection" style="display: none">
          <h2>Requests</h2>
          <div class="scrollable-section1">
            <% if (requests.length > 0) { %>
            <!-- Display requests as a table -->
            <table class="requests-table">
              <thead>
                <tr>
                  <th>Property Name</th>
                  <th>Category</th>
                  <th>Owner Name</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% requests.forEach(function(request) { %>
                <tr>
                  <td><%= request.propertyName %></td>
                  <td><%= request.categoryName %></td>
                  <td><%= request.owner.fullname %></td>
                  <td>
                    <form
                      method="POST"
                      action="/admin/requests/<%= request._id %>/approve"
                      class="action-form"
                    >
                      <button type="submit">Accept</button>
                    </form>
                    <form
                      method="POST"
                      action="/admin/requests/<%= request._id %>/reject"
                      class="action-form"
                    >
                      <button type="submit">Reject</button>
                    </form>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
            <% } else { %>
            <p>No requests found.</p>
            <% } %>
          </div>
        </div>
        
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var profileLink = document.getElementById("profileLink");
        var dashboardLink = document.getElementById("dashboardLink");
        var ownersLink = document.getElementById("ownersLink");
        var usersLink = document.getElementById("usersLink");
        var categoriesLink = document.getElementById("categoriesLink");
        var salesReportLink = document.getElementById("salesReportLink");
        var bookingsLink = document.getElementById("bookingsLink");
        var deletionLink = document.getElementById("deletionLink");
        var requestLink = document.getElementById("requestLink");

        profileLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("profileSection");
        });

        dashboardLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("dashboardSection");
        });

        ownersLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("ownersSection");
        });

        usersLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("usersSection");
        });

        categoriesLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("categoriesSection");
        });

        salesReportLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("salesReportSection");
        });

        bookingsLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("bookingsSection");
        });

        deletionLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("deletionSection");
        });

        requestLink.addEventListener("click", function (event) {
          event.preventDefault();
          displaySection("requestSection");
        });
      });
    </script>
  </body>
</html>
